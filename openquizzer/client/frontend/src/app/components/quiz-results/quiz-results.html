<div class="quiz-results-container">
  <div class="header">
    <h1>Quiz Results</h1>
    <div class="btn-container">
      <button class="btn btn-secondary" (click)="navigateToQuizMaster()">
        Back to Quiz Master
      </button>
    </div>
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading">
    <p>Loading quiz results...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="loadQuizData()">Try Again</button>
  </div>

  <!-- Quiz Results Content -->
  <div *ngIf="!isLoading && !error && quiz" class="quiz-content">
    <!-- Quiz Information Section -->
    <div class="quiz-info-section">
      <div class="quiz-details">
        <div class="detail-item">
          <h3>Question:</h3>
          <p class="quiz-question">{{ quiz.title }}</p>
        </div>
        <div class="detail-item">
          <h3>Expected Answer:</h3>
          <p class="quiz-answer">{{ quiz.answer }}</p>
        </div>
        <div class="detail-item">
          <h3>Difficulty Level:</h3>
          <div class="difficulty-rating">
            <div class="stars-container">
              <span 
                *ngFor="let star of [1,2,3,4,5]; let i = index" 
                class="star"
                [class.filled]="i < getDifficultyLevel()"
                [class.empty]="i >= getDifficultyLevel()">
                ‚òÖ
              </span>
            </div>
            <span class="difficulty-text">{{ getDifficultyText() }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Summary Section with LLM Loading -->
    <div class="results-content">
      <div class="summary-section">
        <h2>Answers Summary</h2>
        
        <!-- Loading state for LLM analysis -->
        <div *ngIf="isLoadingSummary" class="llm-loading">
          <div class="loading-spinner">
            <div class="spinner"></div>
            <p>ü§ñ AI is analyzing student answers...</p>
            <small>This may take a few moments</small>
          </div>
        </div>

        <!-- Error state for LLM analysis -->
        <div *ngIf="summaryError && !isLoadingSummary" class="llm-error">
          <p>‚ùå {{ summaryError }}</p>
          <button class="btn btn-secondary btn-small" (click)="retryTopicSummary()">
            Retry Analysis
          </button>
        </div>

        <!-- LLM Generated Content -->
        <div *ngIf="summaryGenerated && !isLoadingSummary" class="llm-content">
          <!-- <div class="correctness-metric"> -->
            <!-- <span class="correctness-label">LLM Autograded Quiz Taker Correctness</span> --> 
            <!-- <span class="correctness-value">{{ llmSummary.correctness }}%</span> --> 
          <!-- </div> -->

          <!-- Convert the summary text into purple pills -->
          <div class="summary-topics-section">
            <div class="topics-header">AI Generated Answer Topics:</div>
            <div class="topics-container">
              <span 
                *ngFor="let topic of getSummaryTopics()" 
                class="topic-tag">
                {{ topic }}
              </span>
            </div>
          </div>
        </div>

        <!-- Fallback content while LLM loads -->
        <div *ngIf="!summaryGenerated && !isLoadingSummary && !summaryError" class="fallback-content">
          <span class="correctness-placeholder">LLM Autograded Quiz Taker Correctness: Analyzing...</span>
          <p>Generating AI-powered analysis of student responses...</p>
        </div>
      </div>

      <div class="metrics-section">
        <h3>Quiz Metrics</h3>
        <div class="metrics-grid">
          <div class="metric-card">
            <h4>Total Participants</h4>
            <span class="metric-value">{{ participants }}</span>
          </div>
          <div class="metric-card">
            <h4>Total Answers</h4>
            <span class="metric-value">{{ totalAns }}</span>
          </div>
          <div class="metric-card">
            <h4>Participation Rate</h4>
            <span class="metric-value">
              {{ participants > 0 ? ((totalAns / participants) * 100).toFixed(1) + '%' : '0%' }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="btn-container">
    <button class="btn btn-primary" (click)="viewQuiz()">
      Back to Quiz List
    </button>
  </div>
</div>
